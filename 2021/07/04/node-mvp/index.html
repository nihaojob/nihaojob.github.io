<!DOCTYPE html>
<html lang="en">

<head>

  <!-- Minima -->
  <!-- Hexo theme created by @adisaktijrs -->

  <!-- Basic Page Needs
  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
  <meta charset="utf-8">

  
  <title>Node.jså¼€å‘å®è·µï¼Œå‰ç«¯å·¥ç¨‹å¸ˆçš„MVPåˆ©å™¨</title>
  
  <link rel="canonical" href="https://nihaojob.github.io/2021/07/04/node-mvp/">
  
  <meta name="description" content="ä»€ä¹ˆæ˜¯MVPï¼Œæ¥è‡ªä¼Ÿå¤§çš„ç™¾ç§‘:  Minimum Viable Product â€“æœ€ç®€åŒ–å¯å®è¡Œäº§å“ã€‚ æ˜¯æŒ‡ä»¥æœ€ä½æˆæœ¬å°½å¯èƒ½å±•ç°æ ¸å¿ƒæ¦‚å¿µçš„äº§å“ç­–ç•¥ï¼Œå³æ˜¯æŒ‡ç”¨æœ€å¿«ã€æœ€ç®€æ˜çš„æ–¹å¼å»ºç«‹ä¸€ä¸ªå¯ç”¨çš„äº§å“åŸå‹ï¼Œè¿™ä¸ªåŸå‹è¦è¡¨è¾¾å‡ºä½ äº§å“æœ€ç»ˆæƒ³è¦çš„æ•ˆæœï¼Œç„¶åé€šè¿‡è¿­ä»£æ¥å®Œå–„ç»†èŠ‚ã€‚è¯¥æœ¯è¯­ç”±å¼—å…°å…‹Â·ç½—å®¾é€Šå’ŒåŸƒé‡Œå…‹Â·é‡Œæ–¯æ¨å¹¿äº">
  
  
  <meta name="author" content="nihaojob@163.com">
  
  <meta property="og:image" content="https://nihaojob.github.ioundefined">
  
  <meta property="og:site_name" content="ç§¦å°‘å«çš„åšå®¢" />
  <meta property="og:type" content="article" />
  <meta property="og:title" content="Node.jså¼€å‘å®è·µï¼Œå‰ç«¯å·¥ç¨‹å¸ˆçš„MVPåˆ©å™¨" />
  
  <meta property="og:description" content="ä»€ä¹ˆæ˜¯MVPï¼Œæ¥è‡ªä¼Ÿå¤§çš„ç™¾ç§‘:  Minimum Viable Product â€“æœ€ç®€åŒ–å¯å®è¡Œäº§å“ã€‚ æ˜¯æŒ‡ä»¥æœ€ä½æˆæœ¬å°½å¯èƒ½å±•ç°æ ¸å¿ƒæ¦‚å¿µçš„äº§å“ç­–ç•¥ï¼Œå³æ˜¯æŒ‡ç”¨æœ€å¿«ã€æœ€ç®€æ˜çš„æ–¹å¼å»ºç«‹ä¸€ä¸ªå¯ç”¨çš„äº§å“åŸå‹ï¼Œè¿™ä¸ªåŸå‹è¦è¡¨è¾¾å‡ºä½ äº§å“æœ€ç»ˆæƒ³è¦çš„æ•ˆæœï¼Œç„¶åé€šè¿‡è¿­ä»£æ¥å®Œå–„ç»†èŠ‚ã€‚è¯¥æœ¯è¯­ç”±å¼—å…°å…‹Â·ç½—å®¾é€Šå’ŒåŸƒé‡Œå…‹Â·é‡Œæ–¯æ¨å¹¿äº">
  
  <meta property="og:url" content="https://nihaojob.github.io/2021/07/04/node-mvp/" />

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Node.jså¼€å‘å®è·µï¼Œå‰ç«¯å·¥ç¨‹å¸ˆçš„MVPåˆ©å™¨">
  
  <meta name="twitter:description" content="ä»€ä¹ˆæ˜¯MVPï¼Œæ¥è‡ªä¼Ÿå¤§çš„ç™¾ç§‘:  Minimum Viable Product â€“æœ€ç®€åŒ–å¯å®è¡Œäº§å“ã€‚ æ˜¯æŒ‡ä»¥æœ€ä½æˆæœ¬å°½å¯èƒ½å±•ç°æ ¸å¿ƒæ¦‚å¿µçš„äº§å“ç­–ç•¥ï¼Œå³æ˜¯æŒ‡ç”¨æœ€å¿«ã€æœ€ç®€æ˜çš„æ–¹å¼å»ºç«‹ä¸€ä¸ªå¯ç”¨çš„äº§å“åŸå‹ï¼Œè¿™ä¸ªåŸå‹è¦è¡¨è¾¾å‡ºä½ äº§å“æœ€ç»ˆæƒ³è¦çš„æ•ˆæœï¼Œç„¶åé€šè¿‡è¿­ä»£æ¥å®Œå–„ç»†èŠ‚ã€‚è¯¥æœ¯è¯­ç”±å¼—å…°å…‹Â·ç½—å®¾é€Šå’ŒåŸƒé‡Œå…‹Â·é‡Œæ–¯æ¨å¹¿äº">
  
  
  <meta name="twitter:image" content="https://nihaojob.github.ioundefined">
  
  <meta name="twitter:url" content="https://nihaojob.github.io/2021/07/04/node-mvp/" />

  <!-- Mobile Specific Metas
  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Preload fonts
  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
  <link rel="preload" href="../fonts/dm-serif-display-v4-latin-regular.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="../fonts/inter-v2-latin-regular.woff2" as="font" type="font/woff2" crossorigin>

  <!-- CSS
  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
  
<link rel="stylesheet" href="/css/normalize.css">

  
<link rel="stylesheet" href="/css/skeleton.css">

  
<link rel="stylesheet" href="/css/custom.css">

  
<link rel="stylesheet" href="/css/prism-dark.css">

  
<link rel="stylesheet" href="/css/prism-line-numbers.css">

  <!-- User css -->
  
  
<link rel="stylesheet" href="/css/user.css">

  

  <!-- Favicon
  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
  <link rel="icon" type="image/png" href="/images/favicon.png">

  <!-- Custom Theme Color Style
  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
  <style>
  a:not(.icon) {
    text-decoration-color: #0FA0CE;
    background-image: linear-gradient(
      to bottom,
      rgba(0, 0, 0, 0) 50%,
      #0FA0CE 50%
    );
  }
  blockquote {
    border-left: 8px solid #0FA0CE;
  }
  .nanobar .bar {
    background: #0FA0CE;
  }
  .button.button-primary:hover,
  button.button-primary:hover,
  input[type="submit"].button-primary:hover,
  input[type="reset"].button-primary:hover,
  input[type="button"].button-primary:hover,
  .button.button-primary:focus,
  button.button-primary:focus,
  input[type="submit"].button-primary:focus,
  input[type="reset"].button-primary:focus,
  input[type="button"].button-primary:focus {
    background-color: #0FA0CE;
    border-color: #0FA0CE;
  }
  input[type="email"]:focus,
  input[type="number"]:focus,
  input[type="search"]:focus,
  input[type="text"]:focus,
  input[type="tel"]:focus,
  input[type="url"]:focus,
  input[type="password"]:focus,
  textarea:focus,
  select:focus {
    border: 1px solid #0FA0CE;
  }
</style>

  <!-- Google Analytics (With Privacy Settings On)
  â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“â€“ -->
  

<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="ç§¦å°‘å«çš„åšå®¢" type="application/atom+xml">
</head>

<body>
  <div class="container">
    <div class="row">
      <div>

        <div class="row">
  <div class="two columns" style="max-width: 50px">
    <h1 class="mt-2 mode">
      <div onclick=setDarkMode(true) id="darkBtn">ğŸŒ‘</div>
      <div onclick=setDarkMode(false) id="lightBtn" class=hidden>â˜€ï¸</div>
      <script >
        if (localStorage.getItem('preferredTheme') == 'dark') {
          setDarkMode(true)
        }
        function setDarkMode(isDark) {
          var darkBtn = document.getElementById('darkBtn')
          var lightBtn = document.getElementById('lightBtn')
          if (isDark) {
            lightBtn.style.display = "block"
            darkBtn.style.display = "none"
            localStorage.setItem('preferredTheme', 'dark');
          } else {
            lightBtn.style.display = "none"
            darkBtn.style.display = "block"
            localStorage.removeItem('preferredTheme');
          }
          document.body.classList.toggle("darkmode");
        }
      </script>
    </h1>
  </div>

  <div class="six columns ml-1">
    <h1 class="mt-2">
      ç§¦å°‘å«çš„åšå®¢
    </h1>
  </div>

  <div class="twelve columns">
    <div class="row">
      <div class="nine columns left">
        <a href="/">ä¸»é¡µ</a>
        
          
          <a href="/archives" class="ml">å½’æ¡£</a>
          
        
          
          <a href="/About" class="ml">å…³äº</a>
          
        
          
          <a href="/atom.xml" class="ml">RSS</a>
          
        
          
          <a target="_blank" rel="noopener" href="https://juejin.cn/user/3843548383549214" class="ml">æ˜é‡‘</a>
          
        
        
      </div>
    </div>
    <hr style="margin-bottom: 2.6rem">
  </div>
</div>

        <div class="trans">
            <h2>Node.jså¼€å‘å®è·µï¼Œå‰ç«¯å·¥ç¨‹å¸ˆçš„MVPåˆ©å™¨</h2>

  <p>ä»€ä¹ˆæ˜¯MVPï¼Œæ¥è‡ªä¼Ÿå¤§çš„ç™¾ç§‘:</p>
<blockquote>
<p><strong>Minimum Viable Product â€“æœ€ç®€åŒ–å¯å®è¡Œäº§å“</strong>ã€‚</p>
<p>æ˜¯æŒ‡<strong>ä»¥æœ€ä½æˆæœ¬å°½å¯èƒ½å±•ç°æ ¸å¿ƒæ¦‚å¿µçš„äº§å“ç­–ç•¥ï¼Œå³æ˜¯æŒ‡ç”¨æœ€å¿«ã€æœ€ç®€æ˜çš„æ–¹å¼å»ºç«‹ä¸€ä¸ªå¯ç”¨çš„äº§å“åŸå‹</strong>ï¼Œè¿™ä¸ªåŸå‹è¦è¡¨è¾¾å‡ºä½ äº§å“æœ€ç»ˆæƒ³è¦çš„æ•ˆæœï¼Œç„¶åé€šè¿‡è¿­ä»£æ¥å®Œå–„ç»†èŠ‚ã€‚è¯¥æœ¯è¯­ç”±å¼—å…°å…‹Â·ç½—å®¾é€Šå’ŒåŸƒé‡Œå…‹Â·é‡Œæ–¯æ¨å¹¿äºWebåº”ç”¨ç¨‹åº ï¼Œå®ƒä¹Ÿå¯èƒ½æ¶‰åŠåˆ°è¿›è¡Œå¸‚åœºå‰æ‰‹çš„åˆ†æã€‚</p>
</blockquote>
<h3 id="å‰è¨€ï¼š"><a href="#å‰è¨€ï¼š" class="headerlink" title="å‰è¨€ï¼š"></a>å‰è¨€ï¼š</h3><p>Nodeæ˜¯å‰ç«¯å·¥ç¨‹å¸ˆçš„è´µäººï¼Œæ‹“å®½äº†å‰ç«¯å·¥ç¨‹å¸ˆçš„èƒ½åŠ›è¾¹ç•Œï¼Œå¯¹æ¯”å‰å‡ å¹´ç”¨<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/Adobe%20Dreamweaver/10015800?fromtitle=DREAMWEAVER&fromid=216984">Dreamweaver</a>å†™tableé¡µé¢çš„æˆ‘æ¥è¯´ï¼Œæ„Ÿå—åˆ°çš„å˜åŒ–æ˜¯æ—¥æ–°æœˆå¼‚ï¼›å‰ç«¯ææå·¥ç¨‹åŒ–å’Œæ¡†æ¶ä»€ä¹ˆçš„ä¹Ÿå°±ç®—äº†ï¼Œç«Ÿç„¶è¿ç¼–è¾‘å™¨éƒ½è‡ªå·±æğŸ¤”ï¼Œ<strong>jsä½ è¯´ä½ æ˜¯ä¸æ˜¯æœ‰ç‚¹è¿‡åˆ†äº†ï¼Ÿ</strong></p>
<p>å½“ç„¶ï¼Œè¿™ä¸ªè¿‡åˆ†çš„jså¸®åŠ©äº†æˆ‘å¾ˆå¤šï¼Œä»è¢«åç«¯å¤§ä½¬æªç€è€³æœµæŒ‰åˆ°å·¥ä½ä¸Šæ¸©å£°ç»†è¯­çš„è¯´ï¼šâ€œ<strong>æˆ‘å¥—å®Œé¡µé¢æ ·å¼ä¹±äº†ï¼Œå¸®æˆ‘è°ƒä¸‹æ ·å¼</strong>â€ï¼Œæ¼”å˜æˆå¤§ä½¬æ°”å†²å†²çš„è·‘åˆ°æˆ‘å·¥ä½æ…ˆçœ‰å–„ç›®çš„æ‹ç€æ¡Œå­è¯´ï¼šâ€œ<strong>TMæ¥å£å‚æ•°ä¼ é”™äº†</strong>â€ã€‚</p>
<p>æ„Ÿè°¢Nodeå§ï¼Œè‡³å°‘æˆ‘å¯ä»¥åœ¨è‡ªå·±çš„å·¥ä½ä¸Šæ”¹è‡ªå·±å†™çš„Bugäº†ğŸ¤“ã€‚</p>
<p>è¨€å½’æ­£ä¼ ï¼Œå†è¿™ä¹ˆè´«çœŸå°±å†™ä¸ä¸‹å»ä»£ç äº†ï¼Œéšç€Nodeèƒ½åŠ›çš„å‘å±•ï¼Œæˆ‘è‡ªå·±æ„Ÿè§‰å‡ºæ¥è‡ªå·±æœ‰ç‚¹é£˜äº†ï¼Œå› ä¸ºæœ‰ç”¨Kindleçœ‹ä¹¦çš„é™‹ä¹ ï¼Œä¸€ç›´è§‰çš„å¸‚é¢ä¸Šæ‰€æœ‰çš„kindleç¬”è®°è½¯ä»¶éƒ½æ˜¯åƒåœ¾ğŸ¤¥ï¼Œäºæ˜¯è‡ªå·±å†™äº†ä¸€ä¸ªæ»¡æ„çš„åƒåœ¾ï¼›è¿™éƒ½ä¸ç®—å•¥ï¼Œæˆ‘å±…ç„¶å› ä¸ºè¦å‡è‚¥ï¼Œå°±å†™äº†ä¸ªä½“é‡è®°å½•å°ç¨‹åºï¼Œä¸Šçº¿ä»¥åæˆ‘å†²ç€é•œå­é‡Œæµ‘èº«èµ˜è‚‰çš„è‡ªå·±å–Šï¼šâ€œ<strong>ä»¥ä¸ºè‡ªå·±å°±æ˜¯Nodeå—ï¼Ÿè¿‡åˆ†</strong>â€ğŸ¤§ã€‚</p>
<p>ä½“é‡è®°å½•å°ç¨‹åºçš„æ•…äº‹å¹¶æ²¡æœ‰çªå…€çš„ç»“æŸï¼Œæœ‰äº›ç”¨æˆ·åé¦ˆæœ‰bugï¼Œæˆ‘å€Ÿå£taroæ›´æ–°å¤ªå¿«é¡¹ç›®è·‘ä¸èµ·æ¥äº†ï¼Œè€Œä¸”è…¾è®¯äº‘å‡½æ•°æˆ‘ç”¨çš„å¾ˆä¸æ–¹ä¾¿ï¼Œäºæ˜¯å¾ˆä¸è´Ÿè´£çš„åœæ›´äº†ï¼›åœ¨å¹´åç–«æƒ…æœŸé—´ï¼Œå› ä¸ºå®åœ¨å¤ªé—²å°±æ‰“å¼€äº†åå°ç•™è¨€ï¼Œçœ‹åˆ°æœ‰ä¸€ä¸ª<strong>è«åå…¶å¦™çš„ç•™è¨€è¯´å¯»æ±‚åˆä½œ</strong>ğŸ¤·â€â™‚ï¸ã€‚</p>
<p>æˆ‘å¿å¿‘çš„æ‹¨é€šäº†ç”µè¯ï¼Œåœ¨è¯´æ˜äº†æˆ‘æ˜¯å°ç¨‹åºçš„å¼€å‘è€…ä»¥åï¼Œè¿™ä¸ªäººä¸Šæ¥å°±å¼€å§‹è¯´çè¯ï¼šâ€œä½ è¿™ä¸ªå°ç¨‹åºå¤ªå¥½äº†â€ğŸ¤¦â€â™‚ï¸ï¼Œä»–é˜è¿°äº†ä¸€ä¸‹è‡ªå·±çš„ç»å†ï¼Œæ˜¯ä¸€ä½å¼€äº†8å¹´å¥èº«æˆ¿çš„æ•™ç»ƒï¼Œåæ¥æ··ä¸ä¸‹å»æŠŠå¥èº«æˆ¿å…³äº†ï¼Œåšåœ¨çº¿å‡è„‚æŒ‡å¯¼ï¼Œç«Ÿç„¶æ”¶å…¥è¿˜ä¸é”™ï¼ŒçœŸæ˜¯é€ åŒ–å¼„äººğŸ¤ªï¼Œ<strong>ä»–å’¨è¯¢æˆ‘å¯ä»¥ä¸€èµ·åšä¸€ä¸ªå‡è„‚ç®¡ç†ç³»ç»Ÿå—ï¼Ÿä¸è¦é’±é‚£ç§ï¼Œæˆ‘æ¬ä¸çŸ¥è€»çš„è¯´ï¼šâ€œå¥½å‘€â€</strong>ã€‚</p>
<p>ä¸ä¹…æˆ‘ä»¬è§é¢äº†ï¼Œçº¦åœ¨åŒ—äº¬ä¸œäº”ç¯å¤–çš„å¸¸è¥é¾™æ¹–Â·é•¿æ¥¹å¤©è¡—ï¼Œä»–é—®æˆ‘å¯ä»¥åƒå·èœå—ï¼Ÿæˆ‘è¯´å¯ä»¥ï¼Œäºæ˜¯æˆ‘ä»¬æ‰¾äº†ä¸€å®¶è€å±‹å·èœé¦†ï¼Œååœ¨æˆ‘é¢å‰çš„è¿™ä¸ªäººå› ä¸ºåƒäº†ä¸€å£è‡ªå·±ç‚¹çš„è¾£å­é¸¡ï¼Œç„¶åæ‹¿ç€çº¸å·¾ä¸€æŠŠé¼»æ¶•ä¸€æŠŠæ³ªçš„å¿æ‚”è‡ªå·±æ˜¯ä¸ªå‡é‡åº†äººğŸ¤¦â€â™‚ï¸ï¼Œæˆ‘ç¾æ¶©çš„åæ‰äº†å£ä¸­çš„è¾£æ¤’ï¼Œä¸€èµ·æ„æƒ³äº†æˆ‘ä»¬å°ç¨‹åºçš„æœªæ¥ï¼Œ<strong>ç°åœ¨å›æƒ³èµ·è‡ªå·±çš„é«˜è°ˆé˜”è®ºï¼Œéƒ½æœ‰äº›ä¸å¥½æ„æ€</strong>ğŸ˜Œã€‚</p>
<h3 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h3><p>ä¸Šè¾¹çš„æ®µå­æ ¹æ®ä¸ªäººæƒ…å†µæ”¹ç¼–ï¼Œçº¯å±å¨±ä¹ï¼Œå¦‚æœæ²¡æœ‰Nodeçš„å¼€å‘èƒ½åŠ›ï¼Œåˆ«äººå¯èƒ½ä¼šå®‰æ…°æˆ‘ï¼š<strong>â€œä½ è¿˜æ˜¯å»å†™ä¸ªé¡µé¢æŠŠâ€</strong>ï¼ŒğŸ˜­ è‹¦æ¶©çš„æ³ªæ°´ä»çœ¼çœ¶æ¶Œå‡ºã€‚</p>
<p>ç®€å•ä»‹ç»äº†ä¸‹æœ€è¿‘æŠ˜è…¾çš„3ä¸ªé¡¹ç›®çš„ç”±æ¥ï¼Œä»ç¬¬ä¸€ä¸ªä½“é‡è®°å½•å°ç¨‹åºï¼Œåˆ°Kindleç¬”è®°å·¥å…·ï¼Œå†åˆ°ç°åœ¨çš„ä¸€å¥—å°ç¨‹åº + åå°ï¼Œä½œä¸ºä¸€ä¸ªå‰ç«¯ç¨‹åºå‘˜ç‹¬ç«‹ä½œå‡ºä¸€å¥—å¯ä»¥è·‘èµ·æ¥çš„å°ç³»ç»Ÿè¿˜æ˜¯æ¯”è¾ƒæœ‰æˆå°±æ„Ÿçš„ï¼Œè™½ç„¶å¯èƒ½ä¼šè¢«åæ§½ï¼š<strong>ä¸å°±æ˜¯å¢åˆ æ”¹æŸ¥å—ï¼Ÿ</strong> ä½†æ˜¯ä¸ç”¨æ‹…å¿ƒè¢«åæ§½ï¼š<strong>åˆæ²¡å†™è¿‡å¢åˆ æ”¹æŸ¥æ‡‚ä¸ªå±ï¼ŸğŸ˜</strong></p>
<p>ä¸‹è¾¹å†…å®¹ä»‹ç»äº†3ä¸ªé¡¹ç›®çš„ç§¯ç´¯ï¼Œé‡ç‚¹è´´ä¸€ä¸‹ç¬¬ä¸‰ä¸ªé¡¹ç›®Nodeç”¨åˆ°çš„ä»£ç ã€‚<strong>å…±åŒäº¤æµï¼Œæ³è¯·æ–§æ­£</strong>ã€‚</p>
<h3 id="21å¤©ä½“é‡è®°å½•å°ç¨‹åº"><a href="#21å¤©ä½“é‡è®°å½•å°ç¨‹åº" class="headerlink" title="21å¤©ä½“é‡è®°å½•å°ç¨‹åº"></a>21å¤©ä½“é‡è®°å½•å°ç¨‹åº</h3><p>ç´¯è®¡7åƒç”¨æˆ·å’Œæ¯å¤©ä¸è¶…è¿‡20ä¸ªæ´»è·ƒç”¨æˆ·çš„æ•°æ®ï¼Œè¿˜æœ‰3ç¯‡å®è·µç¬”è®°ã€‚<br><strong>å°ç¨‹åºæä¾›çš„Nodeäº‘å‡½æ•° + æ•°æ®åº“ï¼Œå¯ä»¥ä¸èŠ±ä¸€æ¯›é’±å°±èƒ½è·‘èµ·æ¥è‡ªå·±çš„å°ç¨‹åº</strong>ï¼Œæœ€æ—©æ˜¯åŸç”Ÿå†™æ³•ï¼Œåæ¥åˆ‡æ¢åˆ°<code>Taro React</code>è¯­æ³•ï¼Œæ•ˆç‡æé«˜å¾ˆå¤šï¼Œå¯¹å°ç¨‹åºç™»å½•æµç¨‹ã€äº‘å¼€å‘æœ‰äº†ä¸€äº›ç»éªŒç§¯ç´¯ï¼Œä¹Ÿæ„è¯†åˆ°è‡ªå·±å¯¹è¡¨ç»“æ„è®¾è®¡çš„æ¬ ç¼ºã€‚</p>
<p>å¥‡æ€ªçš„æ˜¯ç«Ÿç„¶ç´¯è®¡äº†7åƒç”¨æˆ·ï¼Œç”¨æˆ·ä»å“ªæ¥çš„å‘¢ï¼Œéš¾é“æ˜¯å› ä¸ºåå­—èµ·çš„å¥½å—ï¼ŸğŸ¤”åç»­å‡†å¤‡å†æ›´æ–°æ¢ç´¢ä¸‹ã€‚</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/699419ab5d774792932fff67a6c6b3b2~tplv-k3u1fbpfcp-watermark.image"></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b977eb4d796a482b9034975fbdd03634~tplv-k3u1fbpfcp-watermark.image"></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903894816915463">ã€å°ç¨‹åº + äº‘å¼€å‘ã€‘ä½“é‡è®°å½•å°ç¨‹åº ä¸Šæ‰‹ç¬”è®°</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903896943427597">ã€å°ç¨‹åº + äº‘å¼€å‘ ã€‘ éšæœºè¯»å–æ•°æ®å¹¶ç”Ÿæˆåˆ†äº«å›¾ç‰‡ ä¸Šæ‰‹ç¬”è®°</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903918896414727">ã€å°ç¨‹åº + äº‘å¼€å‘ã€‘ä½“é‡æ’è¡Œæ¦œ ä¸Šæ‰‹ç¬”è®°</a></li>
</ul>
<h3 id="kindle-ç¬”è®°æ•´ç†å·¥å…·"><a href="#kindle-ç¬”è®°æ•´ç†å·¥å…·" class="headerlink" title="kindle ç¬”è®°æ•´ç†å·¥å…·"></a>kindle ç¬”è®°æ•´ç†å·¥å…·</h3><p>æœ€æ—©æ˜¯åœ¨æœ¬åœ°å¼€å‘ï¼Œå¼€å‘äº†ç”¨æˆ·æ³¨å†Œã€å¯†ç æ‰¾å›ã€ä¹¦ç±ç®¡ç†ã€ç¬”è®°ç®¡ç†çš„åŠŸèƒ½ï¼Œç„¶åä¹°æœåŠ¡å™¨éƒ¨ç½²åˆ°çº¿ä¸Šã€‚</p>
<p>å‰ç«¯ä½¿ç”¨çš„ <code>Ant Pro</code>ï¼Œå› ä¸ºå¼•å…¥äº†<code>Echarts</code>ï¼Œæ²¡æœ‰åšæŒ‰éœ€å¼•å…¥ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡è¿›å…¥æ¯”è¾ƒæ…¢ï¼Œç›®å‰åªæœ‰è‡ªå·±ç”¨ï¼Œå°±æ²¡ä¼˜åŒ–ã€‚</p>
<p>æ•´å¥—æµç¨‹è·‘èµ·æ¥ä»¥åï¼Œç”¨ç€è‡ªå·±åšçš„å°å·¥å…·è§‰å¾—è¿˜æŒºé¦™ï¼Œä¹Ÿæœ‰ä¿¡å¿ƒåšä¸€äº›æ›´å¤§çš„æŒ‘æˆ˜äº†ã€‚</p>
<p>åœ°å€ï¼š<a target="_blank" rel="noopener" href="http://nihaojob.com/">http://nihaojob.com/</a></p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3f1e2d2d174a4ea4a855eb77275ac6f1~tplv-k3u1fbpfcp-watermark.image"><br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7f71ee9beadf40c1a1b988176fdfdb6a~tplv-k3u1fbpfcp-watermark.image"><br><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7da7d10e790f4e9783d35e145e1016e9~tplv-k3u1fbpfcp-watermark.image"></p>
<h3 id="å‡è„‚ç®¡ç†ç³»ç»Ÿå¼€å‘"><a href="#å‡è„‚ç®¡ç†ç³»ç»Ÿå¼€å‘" class="headerlink" title="å‡è„‚ç®¡ç†ç³»ç»Ÿå¼€å‘"></a>å‡è„‚ç®¡ç†ç³»ç»Ÿå¼€å‘</h3><p>ç»ˆäºåˆ°ä»Šå¤©çš„ä¸»é¢˜äº†ï¼Œå…ˆè¯´ä¸‹åº”ç”¨åœºæ™¯ï¼Œå­¦å‘˜åœ¨æŠ¥åå‡è„‚æ•™ç»ƒçš„è¯¾ç¨‹åï¼Œæ•™ç»ƒéœ€è¦å…ˆäº†è§£å­¦å‘˜æ—¥å¸¸é¥®é£Ÿã€ç¡çœ ã€è¿åŠ¨ç­‰ç”Ÿæ´»ä¹ æƒ¯ï¼Œç„¶åæ ¹æ®å­¦å‘˜çŠ¶å†µå®šåˆ¶è¿åŠ¨è®¡åˆ’å’Œé¥®é£Ÿæ–¹æ¡ˆï¼Œä»¥åŠæ—¥å¸¸çš„è¿è¥å¦‚å¯¹å­¦å‘˜çš„é¥®é£Ÿå’Œè¿åŠ¨çš„æ‰“å¡å®¡æ ¸ã€ç§¯åˆ†å‡é‡æ’è¡Œæ¦œã€çŸ¥è¯†åº“ç­‰ã€‚</p>
<p><strong>ä¸»è¦çš„6ä¸ªåŠŸèƒ½ï¼š</strong></p>
<ol>
<li>æ•™ç»ƒè´¦å·ç®¡ç†</li>
<li>é—®å·æ”¶é›†</li>
<li>æ–¹æ¡ˆä¸‹å‘</li>
<li>æ‰“å¡å®¡æ ¸</li>
<li>çŸ¥è¯†ç®¡ç†</li>
<li>ç§¯åˆ†ã€å‡é‡æ’è¡Œæ¦œ</li>
</ol>
<p><strong>åå°é¢„è§ˆï¼š</strong><br><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0262dd330c6640c485721bf0fcaf4c41~tplv-k3u1fbpfcp-watermark.image"><br><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7561f7a05aa34daf87e27cdb84a0488e~tplv-k3u1fbpfcp-watermark.image"><br><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7aec2460b51b48398186b66ca71178d0~tplv-k3u1fbpfcp-watermark.image"></p>
<p>å°ç¨‹åºé¢„è§ˆï¼š<br><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7e9148c286444be3a845334a05d352f5~tplv-k3u1fbpfcp-watermark.image"><br><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/35e30326f1564f5393f98ff2065f5ed4~tplv-k3u1fbpfcp-watermark.image"></p>
<h3 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h3><h4 id="æœåŠ¡å™¨-åŸŸå-å¤‡æ¡ˆ"><a href="#æœåŠ¡å™¨-åŸŸå-å¤‡æ¡ˆ" class="headerlink" title="æœåŠ¡å™¨ åŸŸå å¤‡æ¡ˆ"></a>æœåŠ¡å™¨ åŸŸå å¤‡æ¡ˆ</h4><p>æˆ‘æ˜¯ä»æ»´æ»´äº‘ä¸Šä¹°çš„æœåŠ¡å™¨ï¼Œä¸€å¹´æ‰å‡ ç™¾å—ï¼ŒåŸŸåæ˜¯ä¹‹å‰åœ¨è…¾è®¯ä¹°çš„<code>nihaojob.com</code>ï¼Œ<br>å¤‡æ¡ˆè¿‡ç¨‹ä¸­æ»´æ»´è¯´æœ‰æ”¿ç­–è°ƒæ•´ï¼ŒèŠ±äº†20å¤šå¤©çš„æ—¶é—´ï¼Œå¤‡æ¡ˆå»ºè®®æå‰åšå‡†å¤‡ï¼Œå¤‡æ¡ˆæœŸé—´å¯ä»¥æŠŠNginx + Node + Mongodbç¯å¢ƒæ­å»ºèµ·æ¥ã€‚</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/36897f6db6244568bd5eec75a1ea6ab2~tplv-k3u1fbpfcp-watermark.image"></p>
<h4 id="HTTPSè¯ä¹¦ç”³è¯·ä¸Nginxé…ç½®"><a href="#HTTPSè¯ä¹¦ç”³è¯·ä¸Nginxé…ç½®" class="headerlink" title="HTTPSè¯ä¹¦ç”³è¯·ä¸Nginxé…ç½®"></a>HTTPSè¯ä¹¦ç”³è¯·ä¸Nginxé…ç½®</h4><p>å¾®ä¿¡å°ç¨‹åºçš„å¼€å‘åŸŸåå¿…é¡»æ˜¯<code>HTTPS</code>ï¼Œæ»´æ»´äº‘æœ‰å…è´¹çš„è¯ä¹¦ã€‚<br><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/442186f0063f46aaa006b917567e45ac~tplv-k3u1fbpfcp-watermark.image"><br>è¯ä¹¦ç”³è¯·åéœ€è¦åœ¨åŸŸåè§£ææ±‡æ€»å¢åŠ TXTè®°å½•ï¼Œä¸æ‡‚å°±é—®æ»´æ»´äº‘å®¢æœï¼ŒæœåŠ¡å¾ˆniceã€‚<br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b72cbd8c9a97425a9ec9f28a272f1485~tplv-k3u1fbpfcp-watermark.image"><br>è¯ä¹¦ç”³è¯·æˆåŠŸåï¼ŒæŠŠè¯ä¹¦ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œåœ¨Nginxçš„<code>/etc/nginx/conf.d</code>ç›®å½•ä¸‹ï¼Œ<code>https.conf</code>æ–‡ä»¶ä¸­<code>ssl_certificate</code>ã€<code>ssl_certificate_key</code>é…ç½®è¯ä¹¦è·¯å¾„ã€‚</p>
<pre class="line-numbers language-NGINX" data-language="NGINX"><code class="language-NGINX">server &#123;
  listen    443 ssl;
  server_name  api.nihaojob.com;
  ssl_session_timeout 5m;
  ssl_protocols TLSv1 TLSv1.1 TLSv1.2; #æŒ‰ç…§è¿™ä¸ªåè®®é…ç½®
  ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;#æŒ‰ç…§è¿™ä¸ªå¥—ä»¶é…ç½®
  ssl_prefer_server_ciphers on;
  ssl_certificate &#x2F;root&#x2F;sslcert&#x2F;cert.crt;
  ssl_certificate_key &#x2F;root&#x2F;sslcert&#x2F;private.key;
  location &#x2F; &#123;
      alias &#x2F;root&#x2F;coach&#x2F;coach-fe&#x2F;dist&#x2F;;
  &#125;
  location &#x2F;prod-api&#x2F; &#123;
     proxy_pass http:&#x2F;&#x2F;127.0.0.1:3000&#x2F;;
  &#125;
 &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="è·¨åŸŸè®¾ç½®"><a href="#è·¨åŸŸè®¾ç½®" class="headerlink" title="è·¨åŸŸè®¾ç½®"></a>è·¨åŸŸè®¾ç½®</h4><p>è¿™é‡Œè®¾ç½®äº†è·¨åŸŸè¯·æ±‚å¤´ï¼Œå› ä¸º<code>Origin</code>æ˜¯æ ¹æ®å…¥å‚æ¥çš„ï¼Œå¾ˆå®¹æ˜“é€ æˆ<code>CROS</code>æ”»å‡»ï¼Œå¯¹å®‰å…¨ç³»æ•°æœ‰è¦æ±‚çš„ç³»ç»Ÿè¿˜æ˜¯ç”¨åˆ«çš„æ–¹æ¡ˆå§ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>express</code>æ¨èçš„<code>cors</code>ä¸­é—´ä»¶ã€‚</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">app<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Origin"</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Headers'</span><span class="token punctuation">,</span> <span class="token string">'Origin, X-Requested-With, Content-Type, Accept, token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Methods"</span><span class="token punctuation">,</span> <span class="token string">"PUT,POST,GET,DELETE,OPTIONS"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Credentials"</span><span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"application/json;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'OPTIONS'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*è®©optionsè¯·æ±‚å¿«é€Ÿè¿”å›*/</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="express-jwtä½¿ç”¨"><a href="#express-jwtä½¿ç”¨" class="headerlink" title="express jwtä½¿ç”¨"></a>express jwtä½¿ç”¨</h4><p>å‰ç«¯åœ¨ç™»å½•æ—¶æ ¹æ®ç”¨æˆ·<code>id</code>ç”Ÿæˆä¸€ä¸ª<code>Token</code>å‘ç»™å‰ç«¯ï¼Œå‰ç«¯ä¹‹åçš„æ‰€æœ‰è¯·æ±‚éƒ½æºå¸¦è¿™ä¸ª<code>Token</code>ï¼Œåç«¯æ ¹æ®<code>Token</code>è§£å¼€åçš„ç”¨æˆ·idæ¥è¿›è¡Œæ•°æ®æ“ä½œã€‚</p>
<p>åˆ©ç”¨<code>jsonwebtoken</code>ç”Ÿæˆ<code>Token</code>ï¼Œ<code>express-jwt</code>è¿›è¡Œæ ¡éªŒå’Œéå¿…éœ€ç™»å½•æ¥å£æ£€æŸ¥ã€‚</p>
<p>ä¸ªäººè®¤ä¸ºå¼€å‘åŒå­¦éƒ½åº”è¯¥æ·±æŒ–ä¸€ä¸‹æ— çŠ¶æ€<code>Token</code>æœºåˆ¶ä¸æœ‰çŠ¶æ€<code>session</code>æœºåˆ¶çš„çŸ¥è¯†ç‚¹ã€‚</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//å¼•å…¥</span>
<span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jsonwebtoken'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> expressJwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-jwt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//å®šä¹‰ç­¾åå­—ç¬¦ä¸²</span>
<span class="token keyword">const</span> secret <span class="token operator">=</span> <span class="token string">'anyThingString'</span><span class="token punctuation">;</span>

<span class="token comment">//ä½¿ç”¨ä¸­é—´ä»¶éªŒè¯tokenåˆæ³•æ€§</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">expressJwt</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  secret<span class="token operator">:</span> secret<span class="token punctuation">,</span>
  <span class="token function-variable function">getToken</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">fromHeaderOrQuerystring</span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>cookies <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>token <span class="token operator">||</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// ä½¿ç”¨query.token</span>
      <span class="token keyword">return</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>token<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unless</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  path<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'/login'</span><span class="token punctuation">,</span><span class="token string">'/users/register'</span><span class="token punctuation">,</span> <span class="token string">'/students/login'</span><span class="token punctuation">,</span> <span class="token punctuation">]</span>  <span class="token comment">//é™¤äº†è¿™äº›åœ°å€ï¼Œå…¶ä»–çš„URLéƒ½éœ€è¦éªŒè¯</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//æ‹¦æˆªå™¨</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">//å½“tokenéªŒè¯å¤±è´¥æ—¶ä¼šæŠ›å‡ºå¦‚ä¸‹é”™è¯¯</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'UnauthorizedError'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//è¿™ä¸ªéœ€è¦æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘æ¥å¤„ç†ï¼ˆ å…·ä½“çš„errå€¼ è¯·çœ‹ä¸‹é¢ï¼‰</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> code<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> msg<span class="token operator">:</span> <span class="token string">'æœªç™»å½•'</span><span class="token punctuation">,</span> status<span class="token operator">:</span> <span class="token number">41002</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è§£ætokenä¸­é—´ä»¶ åç»­æ‰€æœ‰æ¥å£å¯ç›´æ¥ä½¿ç”¨req.tokenDecodeè·å–å‚æ•°</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// è·å–token</span>
  <span class="token keyword">let</span> token <span class="token operator">=</span> req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>token <span class="token operator">||</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>token<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> decoded <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> secret<span class="token punctuation">)</span><span class="token punctuation">;</span>
    req<span class="token punctuation">.</span>tokenDecode <span class="token operator">=</span> decoded
  <span class="token punctuation">&#125;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//è¿”å›tokenç»™å®¢æˆ·ç«¯.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> mail<span class="token punctuation">,</span> password <span class="token punctuation">&#125;</span><span class="token operator">=</span> req<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
  <span class="token comment">// æ ¼å¼æ ¡éªŒ</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span> mail <span class="token operator">===</span> <span class="token string">''</span> <span class="token operator">||</span> password <span class="token operator">===</span> <span class="token string">''</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> code<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> msg<span class="token operator">:</span> <span class="token string">'éæ³•å‚æ•°'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">const</span> userInfo  <span class="token operator">=</span> <span class="token keyword">await</span> userModel<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> mail<span class="token operator">:</span> mail<span class="token punctuation">,</span> password<span class="token operator">:</span> password  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>userInfo<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> code<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> msg<span class="token operator">:</span> <span class="token string">'ä¿¡æ¯é”™è¯¯'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> _id<span class="token punctuation">,</span> mail<span class="token punctuation">,</span> mobile<span class="token punctuation">,</span> type <span class="token punctuation">&#125;</span> <span class="token operator">=</span> userInfo<span class="token punctuation">;</span>
    <span class="token comment">//ç”Ÿæˆtoken</span>
    <span class="token keyword">const</span> token <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> _id<span class="token punctuation">,</span> mail<span class="token punctuation">,</span> mobile<span class="token punctuation">,</span> type<span class="token punctuation">,</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> secret<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
      expiresIn<span class="token operator">:</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token comment">//ç§’åˆ°æœŸæ—¶é—´</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">,</span> token<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
      maxAge<span class="token operator">:</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">,</span>
      httpOnly<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> code<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> msg<span class="token operator">:</span> <span class="token string">'ç™»å½•æˆåŠŸ'</span><span class="token punctuation">,</span> status<span class="token operator">:</span> <span class="token string">'ok'</span><span class="token punctuation">,</span> data<span class="token operator">:</span><span class="token punctuation">&#123;</span> userInfo<span class="token punctuation">,</span> token <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h4><p>ç¯å¢ƒå˜é‡åœ¨<code>npm script</code>ä¸­è®¾ç½®ï¼Œæœ¬åœ°å¼€å‘æ—¶ç”¨<code>nodemon yarn start</code>ï¼Œéƒ¨ç½²çº¿ä¸Šç¯å¢ƒæ—¶ä½¿ç”¨<code>pm2 start --name coEnd npm -- run startPro</code>ã€‚</p>
<p>éœ€è¦æ ¹æ®ç¯å¢ƒå˜é‡èµ°ä¸åŒçš„æ•°æ®åº“è¿æ¥åœ°å€å’Œå›¾ç‰‡å‰ç¼€åœ°å€ï¼Œå¦‚æœå…¬ä¼—å·æˆ–è€…å°ç¨‹åºæœ‰åŒºåˆ†æµ‹è¯•å’Œæ­£å¼ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥åœ¨è¿™é‡Œé…ç½®<code>APPID</code>å’Œ<code>SECRET</code>ã€‚</p>
<pre class="line-numbers language-JSON" data-language="JSON"><code class="language-JSON">&quot;scripts&quot;: &#123;
    &quot;start&quot;: &quot;NODE_ENV&#x3D;development node .&#x2F;bin&#x2F;www&quot;,
    &quot;startPro&quot;: &quot;NODE_ENV&#x3D;production node .&#x2F;bin&#x2F;www&quot;
  &#125;,<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-JS" data-language="JS"><code class="language-JS">&#x2F;&#x2F; å…¨å±€é…ç½®æ–‡ä»¶ &#x2F;utils&#x2F;config.js
const configBase &#x3D; &#123;
	mongoDb: &#123; &#x2F;&#x2F; æ•°æ®åº“
        development:&#39;mongodb:&#x2F;&#x2F;127.0.0.1:27017&#x2F;coach&#39;,
        production:&#39;mongodb:&#x2F;&#x2F;127.0.0.1:27017&#x2F;coach&#39;,
    &#125;,
    fileUrl:&#123; &#x2F;&#x2F; å›¾ç‰‡åœ°å€
        development:&#39;http:&#x2F;&#x2F;127.0.0.1:3000&#x2F;&#39;,
        production:&#39;https:&#x2F;&#x2F;api.nihaojob.com&#x2F;prod-api&#x2F;&#39;,
    &#125;
&#125;
&#x2F;&#x2F; å¼•ç”¨çš„é…ç½®å¯¹è±¡ åœ¨å„åˆ†æ¨¡å—ä¸­è°ƒç”¨
let infoConfig &#x3D; &#123;&#125;
let envKey &#x3D; process.env.NODE_ENV
&#x2F;&#x2F; é¢„çŸ¥ç¯å¢ƒå˜é‡
let keys &#x3D; [&#39;development&#39;,&#39;production&#39;]
&#x2F;&#x2F; æ‹¼æ¥å¼•ç”¨çš„é…ç½®å¯¹è±¡
Object.keys(configBase).forEach(item &#x3D;&gt; &#123;
	&#x2F;&#x2F; é¢„çŸ¥ç¯å¢ƒå˜é‡
	if(keys.includes(envKey))&#123;
		infoConfig[item] &#x3D; configBase[item][envKey]
	&#125;else&#123;&#x2F;&#x2F; æœ¬åœ°
		infoConfig[item] &#x3D; configBase[item].host
	&#125;
&#125;)
module.exports &#x3D; infoConfig;

&#x2F;&#x2F; ä½¿ç”¨
const &#123; fileUrl &#125; &#x3D; require(&quot;..&#x2F;utils&#x2F;config&quot;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="Mongooes-è¿æ¥"><a href="#Mongooes-è¿æ¥" class="headerlink" title="Mongooes è¿æ¥"></a>Mongooes è¿æ¥</h4><p>åœ¨<code>app.js</code>ä¸­æ‰§è¡Œ <code>require(&#39;./utils/dbs&#39;)()</code>ï¼Œå¹¶ä¸”æŠŠDBå®ä¾‹æŒ‚åˆ°<code>global</code>ä¸Šã€‚</p>
<pre class="line-numbers language-JS" data-language="JS"><code class="language-JS">&#x2F;&#x2F; é…ç½®æ–‡ä»¶
var baseConfig &#x3D; require(&#39;.&#x2F;config.js&#39;);
const dbs &#x3D; async function (env) &#123;
    const mongoose &#x3D; require(&#39;mongoose&#39;);
    mongoose.connect(baseConfig.mongoDb, &#123; useNewUrlParser: true, auto_reconnect: true, poolSize: 10 &#125;);
    const db &#x3D; mongoose.connection;
    db.on(&#39;error&#39;, console.error.bind(console, &#39;æ•°æ®åº“é“¾æ¥å¤±è´¥&#39;));
    db.once(&#39;open&#39;, callback &#x3D;&gt; &#123;
        console.log(&#96;æ•°æ®åº“é“¾æ¥æˆåŠŸï¼Œåœ°å€ï¼š$&#123;baseConfig.mongoDb&#125;&#96;)
    &#125;);
    global.db &#x3D; db;
&#125;
module.exports &#x3D; dbs;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="Mongooes-å¢åˆ æ”¹"><a href="#Mongooes-å¢åˆ æ”¹" class="headerlink" title="Mongooes å¢åˆ æ”¹"></a>Mongooes å¢åˆ æ”¹</h4><p>è¿™éƒ¨åˆ†ä¸å¤šè¯´äº†ï¼Œåˆ©ORMæ¡†æ¶<code>Mongooes</code>å¢åˆ æ”¹ç‰¹åˆ«ç®€å•ï¼Œå…ˆåˆ›å»ºæ¨¡å‹å†æ ¹æ®æ¨¡å‹æ“ä½œã€‚</p>
<pre class="line-numbers language-JS" data-language="JS"><code class="language-JS">const mongoose &#x3D; require(&#39;mongoose&#39;);
const &#123; db &#125; &#x3D; global;
&#x2F;&#x2F; åˆ›å»ºModel
const model &#x3D; new mongoose.Schema(&#123;
    coachId:String, &#x2F;&#x2F; æ•™ç»ƒID
&#125;, &#123;
    timestamps: true, &#x2F;&#x2F; è‡ªåŠ¨å¢åŠ åˆ›å»ºã€æ›´æ–°æ—¶é—´
&#125;);

const dbManage &#x3D; db.model(&#39;tag&#39;, model);
&#x2F;&#x2F; åˆ›å»º
dbManage.create(&#123; name:&#39;&#39; &#125;)
&#x2F;&#x2F; æ›´æ–° å‰è¾¹ä¸ºæŸ¥è¯¢æ¡ä»¶ åè¾¹ä¸ºæ›´æ–°å†…å®¹
dbManage.updateOne(&#123;_id:&#39;id&#39;&#125;,&#123; name:&#39;&#39; &#125;)
&#x2F;&#x2F; åˆ é™¤
dbManage.remove(&#123;_id : &#39;id&#39;&#125;)
&#x2F;&#x2F; æŸ¥æ‰¾
dbManage.find(&#123;_id : &#39;id&#39; &#125;)
dbManage.findOne(&#123;_id : &#39;id&#39; &#125;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="Mongooes-æŸ¥è¯¢"><a href="#Mongooes-æŸ¥è¯¢" class="headerlink" title="Mongooes æŸ¥è¯¢"></a>Mongooes æŸ¥è¯¢</h4><p>æŸ¥è¯¢çš„åŠŸèƒ½æ¯”è¾ƒå¤šäº†ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²æ¨¡ç³ŠæŸ¥è¯¢ï¼Œå¸¸è§çš„åˆ†é¡µã€æ’åºï¼Œæ—¶é—´èŒƒå›´æœç´¢ç­‰ã€‚<br>ç›´æ¥è´´ä¸€ä¸ªæ¨¡æ¿å§ï¼Œcopyç›´æ¥ç”¨ç‰ˆï¼Œå“ˆå“ˆã€‚</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/getList'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> nickName <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> tel <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> newStatus <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> start <span class="token operator">=</span> <span class="token string">'1900-01-01'</span><span class="token punctuation">,</span> end <span class="token operator">=</span> <span class="token string">'2222-01-01'</span>  <span class="token punctuation">&#125;</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> current <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> pageSize <span class="token operator">=</span> <span class="token number">20</span>  <span class="token punctuation">&#125;</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>query
    <span class="token keyword">const</span> startTime <span class="token operator">=</span> <span class="token function">moment</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startOf</span><span class="token punctuation">(</span><span class="token string">'day'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> endTime <span class="token operator">=</span> <span class="token function">moment</span><span class="token punctuation">(</span>end<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startOf</span><span class="token punctuation">(</span><span class="token string">'day'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> queryParams <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        $and<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">&#123;</span> nickName<span class="token operator">:</span> <span class="token punctuation">&#123;</span> $regex<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>nickName<span class="token punctuation">,</span> <span class="token string">'i'</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// æ˜µç§°æ¨¡ç³ŠæŸ¥è¯¢</span>
            <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token punctuation">&#123;</span> $regex<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">'i'</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// å§“åæ¨¡ç³ŠæŸ¥è¯¢</span>
            <span class="token punctuation">&#123;</span> tel<span class="token operator">:</span> <span class="token punctuation">&#123;</span> $regex<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>tel<span class="token punctuation">,</span> <span class="token string">'i'</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>   <span class="token comment">//æ‰‹æœºå·æ¨¡ç³ŠæŸ¥è¯¢</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        coachId<span class="token operator">:</span> req<span class="token punctuation">.</span>tokenDecode<span class="token punctuation">.</span>_id<span class="token punctuation">,</span>
        createdAt<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            $gte<span class="token operator">:</span> startTime<span class="token punctuation">.</span><span class="token function">toDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            $lte<span class="token operator">:</span> <span class="token function">moment</span><span class="token punctuation">(</span>endTime<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endOf</span><span class="token punctuation">(</span><span class="token string">'day'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">// $lte: moment(today).endOf('day').toDate() // æŸ¥è¯¢å½“å¤©</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newStatus <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">// æ•°å­—çŠ¶æ€æ¨¡ç³ŠæŸ¥è¯¢</span>
        queryParams<span class="token punctuation">.</span>$and<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> newStatus<span class="token operator">:</span> newStatus <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// åˆ†é¡µ skipè·³è¿‡æ•° limitæ¯é¡µæ•° sortæ’åºæ–¹å¼</span>
    <span class="token keyword">const</span> resault <span class="token operator">=</span> <span class="token keyword">await</span> studentsModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>queryParams<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">Number</span><span class="token punctuation">(</span>current<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> createdAt<span class="token operator">:</span> <span class="token string">'desc'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ€»æ•°</span>
    <span class="token keyword">const</span> total <span class="token operator">=</span> <span class="token keyword">await</span> studentsModel<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>queryParams<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        code<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span><span class="token punctuation">&#123;</span>
            list<span class="token operator">:</span> resault<span class="token punctuation">,</span>
            page<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                total<span class="token punctuation">,</span>
                current<span class="token operator">:</span> <span class="token function">Number</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// å½“å‰é¡µ</span>
                pageSize<span class="token operator">:</span> <span class="token function">Number</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="å›¾ç‰‡ä¸Šä¼ "><a href="#å›¾ç‰‡ä¸Šä¼ " class="headerlink" title="å›¾ç‰‡ä¸Šä¼ "></a>å›¾ç‰‡ä¸Šä¼ </h4><p>å¾ˆå¤šåœ°æ–¹éƒ½è¦ç”¨åˆ°å›¾ç‰‡ä¸Šä¼ ï¼Œä½¿ç”¨<code>formidable</code>æ’ä»¶ï¼Œè®¾ç½®ä¸Šä¼ è·¯å¾„ä¸º<code>public</code>ï¼Œæ ¹æ®ç¯å¢ƒå˜é‡ + æ–‡ä»¶åæ‹¼æ¥å›¾ç‰‡åœ°å€ï¼Œå•ç‹¬æŠŠå›¾ç‰‡åœ°å€å­˜åˆ°ä¸€å¼ è¡¨ä¸­ï¼Œæ–¹ä¾¿å…¶ä»–åœ°æ–¹å¤ç”¨ã€‚</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> formidable <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'formidable'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> inFileModel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"../model/inFile"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ç¯å¢ƒå˜é‡é…ç½®</span>
<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> fileUrl <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"../utils/config"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ä¸Šä¼ æ–‡ä»¶</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> imgPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'/public'</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> form <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">formidable<span class="token punctuation">.</span>IncomingForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    form<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">;</span> <span class="token comment">//è®¾ç½®ç¼–è¾‘</span>
    form<span class="token punctuation">.</span>uploadDir <span class="token operator">=</span> imgPath<span class="token punctuation">;</span> <span class="token comment">//è®¾ç½®ä¸Šä¼ ç›®å½•</span>
    form<span class="token punctuation">.</span>keepExtensions <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">//ä¿ç•™åç¼€</span>
    form<span class="token punctuation">.</span>maxFieldsSize <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span> <span class="token comment">//æ–‡ä»¶å¤§å°</span>
    form<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">awaitFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            form<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> fields<span class="token punctuation">,</span> files</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">let</span> src <span class="token operator">=</span> files<span class="token punctuation">.</span>file<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">let</span> urlString <span class="token operator">=</span> src<span class="token punctuation">[</span>src<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>urlString<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token comment">// æ–‡ä»¶å</span>
    <span class="token keyword">const</span> filePath <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">awaitFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å‚¨å­˜ä¸Šä¼ è®°å½•</span>
    <span class="token keyword">const</span> fileInfo <span class="token operator">=</span> <span class="token keyword">await</span> inFileModel<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> fileName<span class="token operator">:</span>fileUrl <span class="token operator">+</span> filePath<span class="token punctuation">,</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> code<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> msg<span class="token operator">:</span><span class="token string">'ä¸Šä¼ æˆåŠŸ'</span><span class="token punctuation">,</span> data<span class="token operator">:</span>fileInfo <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="å®šæ—¶è·å–accesstoken"><a href="#å®šæ—¶è·å–accesstoken" class="headerlink" title="å®šæ—¶è·å–accesstoken"></a>å®šæ—¶è·å–accesstoken</h4><p>æœ‰è¿‡å¾®ä¿¡å¼€å‘ç»éªŒçš„åŒå­¦éƒ½çŸ¥é“ï¼Œè°ƒç”¨å¾®ä¿¡æœåŠ¡ç«¯apiéœ€è¦<code>accesstoken</code>ï¼Œæ—¶æ•ˆ2å°æ—¶ï¼Œåˆ©ç”¨<code>CronJob</code>å®šæ—¶è·å–<code>accesstoken</code>å¹¶ä¿å­˜æˆæ–‡ä»¶ï¼Œè·å–å¤±è´¥æ—¶åˆ©ç”¨<code>nodemailer</code>å‘é€æŠ¥è­¦é‚®ä»¶ã€‚</p>
<p>åœ¨éƒ¨ç½²æ—¶å•ç‹¬è·‘ä¸€ä¸ªPM2è¿›ç¨‹ï¼Œ<code>pm2 start cronTask.js</code>ã€‚</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// cronTask.js</span>
<span class="token keyword">var</span> CronJob <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cron'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>CronJob<span class="token punctuation">;</span>
<span class="token keyword">const</span> moment <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'moment'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> writeFile <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>promises
<span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> weConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./utils/weConfig'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> nodemailer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'nodemailer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è·å–å¾®ä¿¡token</span>
<span class="token keyword">var</span> getWeToken <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CronJob</span><span class="token punctuation">(</span><span class="token string">'0 0 0/1 * * *'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'è·å–tokenä»»åŠ¡æ‰§è¡Œï¼š'</span><span class="token punctuation">,</span> <span class="token function">moment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'YYYY-MM-DD HH:mm:ss'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> <span class="token constant">APPID</span><span class="token punctuation">,</span> <span class="token constant">SECRET</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> weConfig
  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">APPID</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">&amp;secret=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token constant">SECRET</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>
  axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// ä¿å­˜accesstokenæ–‡ä»¶</span>
      <span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'./accesstoken.txt'</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>access_token<span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// å‘é€æŠ¥è­¦å†…å®¹</span>
      <span class="token function">sendMail</span><span class="token punctuation">(</span><span class="token string">'nihaojob@163.com'</span><span class="token punctuation">,</span> <span class="token string">'ä¿å­˜é”™è¯¯ï¼š'</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">'America/Los_Angeles'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">sendMail</span><span class="token punctuation">(</span><span class="token parameter">mail<span class="token punctuation">,</span> text</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// å‘é€é‚®ç®±é…ç½®</span>
  <span class="token keyword">var</span> mailTransport <span class="token operator">=</span> nodemailer<span class="token punctuation">.</span><span class="token function">createTransport</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    host<span class="token operator">:</span> <span class="token string">'smtp.163.com'</span><span class="token punctuation">,</span>
    port<span class="token operator">:</span> <span class="token number">465</span><span class="token punctuation">,</span>
    secureConnection<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// ä½¿ç”¨SSLæ–¹å¼ï¼ˆå®‰å…¨æ–¹å¼ï¼Œé˜²æ­¢è¢«çªƒå–ä¿¡æ¯ï¼‰</span>
    auth<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      user<span class="token operator">:</span> <span class="token string">'é‚®ç®±'</span><span class="token punctuation">,</span>
      pass<span class="token operator">:</span> <span class="token string">'å¯†ç '</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>mailTransport<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> from<span class="token operator">:</span> <span class="token string">'nihaojob@163.com'</span><span class="token punctuation">,</span> to<span class="token operator">:</span> mail <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    subject<span class="token operator">:</span> <span class="token string">'tokenè·å–å¤±è´¥æŠ¥è­¦'</span><span class="token punctuation">,</span>
    text<span class="token operator">:</span> text<span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  mailTransport<span class="token punctuation">.</span><span class="token function">sendMail</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> msg</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> code<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> msg<span class="token operator">:</span> err <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">&#125;</span>
    mailTransport<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

getWeToken<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="ç”Ÿæˆå°ç¨‹åºå‚æ•°äºŒç»´ç "><a href="#ç”Ÿæˆå°ç¨‹åºå‚æ•°äºŒç»´ç " class="headerlink" title="ç”Ÿæˆå°ç¨‹åºå‚æ•°äºŒç»´ç "></a>ç”Ÿæˆå°ç¨‹åºå‚æ•°äºŒç»´ç </h4><p>è¯»å–<code>accesstoken.txt</code>è·å–<code>token</code>ï¼Œåˆ©ç”¨<code>axios</code>å‘é€ç»™å¾®ä¿¡æœåŠ¡å™¨è·å–å›¾ç‰‡ï¼Œè¿™å—æœ‰ä¸ªç‚¹éœ€è¦æ³¨æ„ï¼Œè¯·æ±‚ä¼šç›´æ¥è¿”å›å›¾ç‰‡ï¼Œéœ€è®¾ç½®<code>responseType: &#39;arraybuffer&#39;</code>ç›´æ¥æŠŠ<code>buffer</code>æ•°æ®ä¿å­˜ä¸ºå›¾ç‰‡ã€‚</p>
<pre class="line-numbers language-JS" data-language="JS"><code class="language-JS">var express &#x3D; require(&#39;express&#39;);
var router &#x3D; express.Router();
const &#123; fileUrl &#125; &#x3D; require(&quot;..&#x2F;utils&#x2F;config&quot;);
const &#123; writeFile, readFile &#125; &#x3D; require(&#39;fs&#39;).promises

const axios &#x3D; require(&#39;axios&#39;)
router.post(&#39;&#x2F;getQrcode&#39;, async function (req, res, next) &#123;
  const &#123; path &#x3D; &#39;&#39;, scene &#x3D; &#39;&#39; &#125; &#x3D; req.body;
  &#x2F;&#x2F; æ ¼å¼æ ¡éªŒ
  if (path &#x3D;&#x3D;&#x3D; &#39;&#39;)&#123;
    res.send(&#123; code: -1, msg: &#39;éæ³•å‚æ•°&#39; &#125;);
    return
  &#125;

  const accessToken &#x3D; await readFile(&#39;.&#x2F;accesstoken.txt&#39;)
  const url &#x3D; &#96;https:&#x2F;&#x2F;api.weixin.qq.com&#x2F;wxa&#x2F;getwxacodeunlimit?access_token&#x3D;$&#123;accessToken.toString()&#125;&#96;
  const data &#x3D; await axios.post(url,&#123;
    scene: scene,
    page: path,
    width:430,
  &#125;,&#123;
    headers:&#123;
      &quot;Content-Type&quot;: &quot;application&#x2F;json&quot;
    &#125;,
    responseType: &#39;arraybuffer&#39;,
  &#125;)
  if (data.data)&#123;
    const fileName &#x3D;  &#39;qrCode_&#39; + new Date().getTime() + &#39;.jpg&#39;
    await writeFile(&#39;.&#x2F;public&#x2F;&#39; + fileName, data.data)
    res.send(&#123; code: 1, data: fileUrl + fileName &#125;);
  &#125;else&#123;
    res.send(&#123; code:-1, msg:&#39;è¯·æ±‚é”™è¯¯&#39; &#125;)
  &#125;
&#125;);
module.exports &#x3D; router;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="for-awaitä½¿ç”¨"><a href="#for-awaitä½¿ç”¨" class="headerlink" title="for awaitä½¿ç”¨"></a>for awaitä½¿ç”¨</h4><p>æˆ‘ä»¬æœ‰ä¸€ä¸ªç”¨æˆ·åˆ—è¡¨ï¼Œéœ€è¦æ ¹æ®ç”¨æˆ·åˆ—è¡¨é‡Œçš„ç”¨æˆ·idæŸ¥è¯¢å¦å¤–ä¸€å¼ åˆ—è¡¨é‡Œçš„ç”¨æˆ·è¯¦æƒ…ï¼Œå°†ä»–ä»¬æ‹¼æ¥æˆä¸€ä¸ªæ–°çš„åˆ—è¡¨è¿”å›ç»™å‰ç«¯ï¼Œæˆ‘ä¸å¤ªä¼šç”¨å…³è”æŸ¥è¯¢ï¼Œæ¢ç´¢å‡ºä¸€ä¸ªæ¯”è¾ƒç¬¨çš„æ–¹æ³•ï¼Œç”¨<code>for await</code>è¿™ç§æ–¹æ³•å®ç°çš„ã€‚</p>
<pre class="line-numbers language-JS" data-language="JS"><code class="language-JS">router.get(&#39;&#x2F;getTopList&#39;, async function (req, res, next) &#123;
    const &#123; coachId &#125; &#x3D; req.tokenDecode;
    let data &#x3D; await topModel.find(&#123; coachId &#125;).sort(&#123; integral: &#39;desc&#39; &#125;);
    if (data &amp;&amp; data.length !&#x3D;&#x3D; 0) &#123;
        data &#x3D; JSON.parse(JSON.stringify(data))
        for (const item of data) &#123;
            const info &#x3D; await studentsModel.findOne(&#123; _id: item.studentsId&#125;)
            item.info &#x3D; info
        &#125;
    &#125;
    res.send(&#123;code: 1, data &#125;)
&#125;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="taroå°ç¨‹åº"><a href="#taroå°ç¨‹åº" class="headerlink" title="taroå°ç¨‹åº"></a>taroå°ç¨‹åº</h4><p>è¿™ç¯‡ç¬”è®°çš„é‡ç‚¹åœ¨Nodeä¸Šï¼Œå°±ä¸å±•å¼€èŠäº†ï¼Œç®€å•å†™ä¸‹ç™»å½•ã€requestå°è£…ã€ç¯å¢ƒå˜é‡ã€‚</p>
<p><strong>ç™»å½•</strong></p>
<p>ç™»å½•çš„æµç¨‹æ˜¯ï¼Œç”¨æˆ·ç‚¹å‡»<code>openType</code>ä¸º<code>getUserInfo</code>çš„æŒ‰é’®å‘èµ·æˆæƒï¼ŒæˆæƒæˆåŠŸåè°ƒç”¨<code>Taro.login</code>è·å–<code>code</code>ï¼Œå†æŠŠ<code>code</code>å‘ç»™åç«¯ï¼Œåç«¯é€šè¿‡<code>code</code>ã€<code>APPID</code>ã€<code>SECRET</code>è·å–<code>openid</code>ï¼Œå‰©ä¸‹çš„å°±æ˜¯ç”¨<code>openid</code>æ¥ç»‘å®šç”¨æˆ·å…³ç³»äº†ã€‚</p>
<blockquote>
<p>getUserInfoæŒ‰é’® =&gt; æˆæƒ =&gt; getCode =&gt; è·å–openid</p>
</blockquote>
<p><strong>taro-request</strong></p>
<p>taroå®˜ç½‘ä¸Šæœ‰ä¸€ä¸ª<code>taro-request</code>çš„å°è£…ï¼Œè›®å¥½ç”¨çš„<a target="_blank" rel="noopener" href="https://github.com/TigerHee/taro-request">åœ°å€</a>ã€‚</p>
<p><strong>ç¯å¢ƒå˜é‡</strong></p>
<p>Taroçš„ç¯å¢ƒå˜é‡ä»<code>process.env.NODE_ENV</code>ä¸­è¯»å–ï¼Œå†…ç½®ç¯å¢ƒå˜é‡ä¸º<code>development</code>ã€<code>production</code>ï¼Œå‰ç«¯éœ€è¦æ ¹æ®ç¯å¢ƒå˜é‡èµ°ä¸åŒçš„ç¯å¢ƒã€‚</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">getBaseUrl</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> <span class="token constant">BASE_URL</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//å¼€å‘ç¯å¢ƒ</span>
    <span class="token constant">BASE_URL</span> <span class="token operator">=</span> <span class="token string">'http://localhost:3000'</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// ç”Ÿäº§ç¯å¢ƒ</span>
    <span class="token constant">BASE_URL</span> <span class="token operator">=</span> <span class="token string">'https://api.nihaojob.com/prod-api'</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token constant">BASE_URL</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> getBaseUrl<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h4 id="åå°éƒ¨åˆ†"><a href="#åå°éƒ¨åˆ†" class="headerlink" title="åå°éƒ¨åˆ†"></a>åå°éƒ¨åˆ†</h4><p>åå°ä½¿ç”¨<code>vue-element-admin</code>æ¨¡æ¿ï¼Œå‡ ä¹æ²¡æœ‰å¤æ‚çš„å†…å®¹ï¼Œæ¥å…¥äº†å›¾è¡¨ã€å¯Œæ–‡æœ¬ã€å›¾ç‰‡ä¸Šä¼ ï¼Œå°±ä¸å±•å¼€äº†ï¼Œåç»­ä¼šå¼€å‘å‘èœå•ã€æƒé™ç®¡ç†ï¼Œæœ‰å¯èƒ½ä½¿ç”¨<code>node-casbin</code>æˆ–<code>acl</code>å®ç°ã€‚</p>
<h4 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h4><p>å‰ç«¯é™æ€æ–‡ä»¶ç›´æ¥ä½¿ç”¨<code>Nginx</code>æŒ‡å®šé™æ€ç›®å½•ï¼Œåç«¯æ¥å£é€šè¿‡PM2å¯åŠ¨æœåŠ¡ï¼Œå¹¶ç”¨<code>Nginx</code>çš„<code>proxy_pass</code>è½¬åˆ°åç«¯æœåŠ¡ç«¯å£ä¸Šã€‚<strong>HTTPSè¯ä¹¦ç”³è¯·ä¸Nginxé…ç½®</strong>å°èŠ‚ä¸­æœ‰è´´å‡ºï¼Œåˆ—ä¸€ä¸‹è‡ªå·±æœ€å¸¸ç”¨çš„å‡ ä¸ªPM2å‘½ä»¤ã€‚</p>
<pre class="line-numbers language-BASH" data-language="BASH"><code class="language-BASH">&#x2F;&#x2F; npm script å¯åŠ¨åº”ç”¨
$ pm2 start --name åº”ç”¨åç§° npm -- run &#39;npm sctiptåç§°&#39;
&#x2F;&#x2F; åº”ç”¨åˆ—è¡¨
$ pm2 list
&#x2F;&#x2F; æŸ¥çœ‹æ—¥å¿—
$ pm2 log
&#x2F;&#x2F; é‡å¯åº”ç”¨
$ pm2 restart &#39;åº”ç”¨id&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/aed14f790ef64f66b907639f2e7acb1f~tplv-k3u1fbpfcp-watermark.image"></p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å¼€å¤´æ®µå­ä¸­æœ‰è°ƒä¾ƒåç«¯å¤§ä½¬ï¼Œçº¯ç²¹åªæ˜¯ç©ç¬‘ï¼›äº’è”ç½‘æŠ€æœ¯æ—¥æ–°æœˆå¼‚ï¼Œå¤§å®¶éƒ½åœ¨é½å¤´å¹¶è¿›ï¼Œå‰ç«¯çš„å†…å®¹éƒ½å­¦ä¸å®Œï¼Œåˆæ€æ•¢å¯¹ä¸æ‡‚çš„è¡Œä¸šæŒ‡æ‰‹ç”»è„šã€‚å¸Œæœ›è‡ªå·±<strong>æ‹¥æŠ±å˜åŒ–ï¼Œä¿æŒæ•¬ç•</strong>ã€‚</p>
<p>å¬è¯´æ¯ä¸ªç¨‹åºå‘˜éƒ½æœ‰ä¸€ä¸ªåˆ›ä¸šæ¢¦ï¼Œå‰ç«¯å·¥ç¨‹å¸ˆçœŸçš„å¯ä»¥å€ŸåŠ©Nodeè·‘èµ·æ¥è‡ªå·±çš„ç¬¬ä¸€ä¸ªMVPã€‚</p>

  <p> â€” 2021å¹´7æœˆ4æ—¥</p>
  


          <div class="row mt-2">
  
    <div class="eight columns">
      <p id="madewith" style="color: #c7c7c7;">é™æ°´æµæ·±ï¼Œé—»å–§äº«é™ã€‚ç©ºå±±é¸£å“ï¼Œè§æƒ¯å¸ç©ºã€‚
        
    </div>

    <!-- Sepcial thanks to https://simpleicons.org/ for the icons -->
    <div class="four columns mb-3 posisi" >
      
      <a class="ml-0 footer-link icon" href="https://github.com/nihaojob" target="_blank" style="text-decoration: none" rel="noreferrer" aria-label="GitHub">
        <svg class="github svg-hov" width="18" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
      </a>
      

      

      

      

      

    </div>
  
</div>

        </div>
      </div>

    </div>

  </div>
  <script src="/js/nanobar.min.js"></script>
  <script>
    var options = {
      classname: 'nanobar',
      id: 'myNanobar'
    };
    var nanobar = new Nanobar(options);
    nanobar.go(30);
    nanobar.go(76);
    nanobar.go(100);
  </script>

</body>

</html>
